package groupProjects;

import java.util.*;
import java.io.*;

public class VirusSimulation {

	public static void main(String[] args) {
		Scanner scnr = new Scanner(System.in);
		
	// user input validation for alpha (infection rate) 
		float alpha;
		do{
			System.out.println("Enter the rate of infection alpha (alpha <= .25): ");
			alpha = scnr.nextFloat();
		} while (alpha>.25 || alpha < 0);
		
	// user input validation for beta (recovery rate)
		float beta;
		do {
			System.out.println("Please input the recovery rate. It should be between 0 and 1.");
			beta = scnr.nextFloat();
		} while(beta<0 || beta>1);
		
	// user input validation for numIdv (number of individuals)
		int numIdv;
		do {
			System.out.println("Please input a number of individuals. It should be a perfect square value.");
			numIdv = scnr.nextInt();
		} while (numIdv % (Math.sqrt(numIdv)) != 0 || numIdv < 4);
		
	// user input validation for numSteps (number of steps)
		int numSteps;
		do {
			System.out.println("Please input the number of times the simulation will run.");
			numSteps = scnr.nextInt();
		} while(numSteps<=0);
		
		int firstInfected;
		do {
			System.out.println("Please input the first person that is infected.");
			firstInfected = scnr.nextInt();
		} while(firstInfected < 0 || firstInfected > numIdv);
		
//		********************************************************************************************************************************
//		Ethan's Code - when u guys can u should take a look at my code to understand how it works and to know where to add ur guys parts
//		(it has most of what we have done combined)
//		- corrected user input validation from above
//		- create string based on user input
//		- check which string indicies are corners, edges(top,bottom,left,right), and inside
//		- format string output in array
//		-------------------welcome to change stuff to make more efficient BUT KEEP MAIN STRUCTURE PLS-----------------------
//		*********************************************************************************************************************************
		int numRecovered = 0;
		int numInfected = 0;
		int numSuseptable = 0;
		
		//ask user to input perfect square 
		System.out.println("Please input a number of individuals. It should be a perfect square value.");
		Scanner scnr = new Scanner(System.in);
		int numIndiv = scnr.nextInt();
		System.out.println("Please input a number of individuals. It should be a perfect square value.");
		int indexOfInfected = scnr.nextInt();
		
		//userInput validation
		double root = Math.sqrt(numIndiv);
		while ((Math.floor(root)-root)!=0){
			System.out.println("Please input a number of individuals. It should be a perfect square value.");
			numIndiv = scnr.nextInt();
			root = Math.sqrt(numIndiv);
		}
		int numRows = (int) Math.sqrt(numIndiv);//used for later calculations
		
		//user input validation for numSteps (number of steps)
		int numSteps;
		do {
			System.out.println("Please input the number of times the simulation will run.");
			numSteps = scnr.nextInt();
		} while(numSteps<=0);
		
		// user input validation for alpha (infection rate) 
		float alpha;
		do{
			System.out.println("Enter the rate of infection alpha (alpha <= .25): ");
			alpha = scnr.nextFloat();
		} while (alpha>.25 || alpha < 0);
		
		// user input validation for beta (recovery rate)
		float beta;
		do {
			System.out.println("Please input the recovery rate. It should be between 0 and 1.");
			beta = scnr.nextFloat();
		} while(beta<0 || beta>1);
		
		//create string based on user input
		int counter = 0;
		String createdString = "";
		while (numIndiv>counter) {
			if (counter==indexOfInfected) {
				createdString = createdString + "I";
			}
			createdString = createdString + "S";
			++counter;
		}
		System.out.println(createdString);
		
		StringBuilder outputString = new StringBuilder(createdString);//need this syntax to change individual characters of string
		int currentRowNum = 1;//declare row number
		for(int i = 0; i < numSteps; i++){
			for (int stringIndex = 1; stringIndex<=numIdv; ++stringIndex) {//iterate through entire string char by char
				//check is user is already recovered
				if (outputString.charAt(stringIndex-1)=='R') {
					continue;
				}
				//check and test top left corner piece
				if (stringIndex==1) {
					if(testRightNeighbor(stringIndex, numIdv, createdString)+testBottomNeighbor(stringIndex, numIdv, createdString)>0) {
						if(getNumber0to100()<=(alpha*(testRightNeighbor(stringIndex, numIdv, createdString)+testBottomNeighbor(stringIndex, numIdv, createdString))))
							outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
						}
					}
				//check and test top right corner piece
				else if (stringIndex==numRows) {
					if(testLeftNeighbor(stringIndex, numIdv, createdString)+testBottomNeighbor(stringIndex, numIdv, createdString)>0) {
						if(getNumber0to100()<=(100*alpha*(testLeftNeighbor(stringIndex, numIdv, createdString)+testBottomNeighbor(stringIndex, numIdv, createdString))))
							outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
						}
					}
				//check and test bottom left corner piece
				else if (stringIndex==numIdv-numRows+1) {
					if(testRightNeighbor(stringIndex, numIdv, createdString)+testTopNeighbor(stringIndex, numIdv, createdString)>0) {
						if(getNumber0to100()<=(100*alpha*(testRightNeighbor(stringIndex, numIdv, createdString)+testTopNeighbor(stringIndex, numIdv, createdString))))
							outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
					}
				}
				//check and test bottom right corner piece
				else if (stringIndex==numIdv) {
					if(testLeftNeighbor(stringIndex, numIdv, createdString)+testTopNeighbor(stringIndex, numIdv, createdString)>0) {
						if(getNumber0to100()<=(100*alpha*(testLeftNeighbor(stringIndex, numIdv, createdString)+testTopNeighbor(stringIndex, numIdv, createdString))))
							outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
					}
				}
				//check and test right edge piece
				else if (stringIndex>numRows && stringIndex!=numIdv && stringIndex%numRows == 0 && stringIndex!=1 && stringIndex!=numRows && stringIndex!=numIdv-numRows+1) {
					if(testLeftNeighbor(stringIndex, numIdv, createdString)+testBottomNeighbor(stringIndex, numIdv, createdString)+testTopNeighbor(stringIndex, numIdv, createdString)>0) {
						if(getNumber0to100()<=(100*alpha*(testLeftNeighbor(stringIndex, numIdv, createdString)+testBottomNeighbor(stringIndex, numIdv, createdString)+testTopNeighbor(stringIndex, numIdv, createdString))))
							outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
					}
				}
				//check and test left edge piece
				else if (currentRowNum>1 && stringIndex==(currentRowNum-1)*(numRows)+1 && stringIndex!=numIdv-numRows+1 && stringIndex!=1 && stringIndex!=numRows && stringIndex!=numIdv-numRows+1) {
					if(testRightNeighbor(stringIndex, numIdv, createdString)+testBottomNeighbor(stringIndex, numIdv, createdString)+testTopNeighbor(stringIndex, numIdv, createdString)>0) {
						if(getNumber0to100()<=(100*alpha*(testRightNeighbor(stringIndex, numIdv, createdString)+testBottomNeighbor(stringIndex, numIdv, createdString)+testTopNeighbor(stringIndex, numIdv, createdString))))
							outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
					}
				}
				//check and test top edge pieces
				else if (stringIndex < numRows && stringIndex>0 && stringIndex!=1 && stringIndex!=numRows && stringIndex!=numIdv-numRows+1){
					if(testBottomNeighbor(stringIndex, numIdv, createdString)+testLeftNeighbor(stringIndex, numIdv, createdString)+testRightNeighbor(stringIndex, numIdv, createdString)>0) {
						if(getNumber0to100()<=(100*alpha*(testBottomNeighbor(stringIndex, numIdv, createdString)+testLeftNeighbor(stringIndex, numIdv, createdString)+testRightNeighbor(stringIndex, numIdv, createdString))))
							outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
					}
				}
				//check and test bottom edge piece
				else if (currentRowNum == numRows && stringIndex>((currentRowNum-1)*(numRows)+1) && stringIndex<numIdv && stringIndex!=1 && stringIndex!=numRows && stringIndex!=numIdv-numRows+1) {
					if(testTopNeighbor(stringIndex, numIdv, createdString)+testLeftNeighbor(stringIndex, numIdv, createdString)+testRightNeighbor(stringIndex, numIdv, createdString)>0) {
						if(getNumber0to100()<=(100*alpha*(testTopNeighbor(stringIndex, numIdv, createdString)+testLeftNeighbor(stringIndex, numIdv, createdString)+testRightNeighbor(stringIndex, numIdv, createdString))))
							outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
					}
				}
				//all inside people
				else{
					if(testLeftNeighbor(stringIndex, numIdv, createdString)+testLeftNeighbor(stringIndex, numIdv, createdString)+testBottomNeighbor(stringIndex, numIdv, createdString)+testTopNeighbor(stringIndex, numIdv, createdString)>0) {
					if(getNumber0to100()<=(100*alpha*(testLeftNeighbor(stringIndex, numIdv, createdString)+testRightNeighbor(stringIndex, numIdv, createdString)+testBottomNeighbor(stringIndex, numIdv, createdString)+testTopNeighbor(stringIndex, numIdv, createdString))))
						outputString.setCharAt(stringIndex-1,'I'); //change inside people status
					}
				}
				//increment currentRowNum 
				if (stringIndex%numRows==0 && stringIndex > 0 && stringIndex<numIdv) {
				++currentRowNum;
					/*System.out.print(stringIndex + " ");
					System.out.println(currentRowNum);*/
				}
			}
		
		//format outputString and print
		for (int i= 1;outputString.length()>=i;++i) {
			System.out.print(outputString.charAt(i-1));
			if (i%numRows == 0 && i>0) {
				System.out.println("");
			}
		}

			//format outputString and print
			try {
			FileWriter fWriter = new FileWriter("virussim.txt", true);
			PrintWriter pWriter = new PrintWriter(fWriter);
			int infecNum = 0;
			int recovNum = 0;
			int susNum = 0;
			int gcd = 0;
			for (int i= 1;outputString.length()>=i;++i) {
				System.out.print(outputString.charAt(i-1));
				pWriter.print(outputString.charAt(i-1));
				if (i%numRows == 0 && i>0) {
					System.out.println("");
					pWriter.println("");
				}
			}
			for (int i=1; outputString.length()>=i; i++) {
				if(outputString.charAt(i-1)=='I') {
					infecNum++;
				}
			}
			for (int i=1; outputString.length()>=i; i++) {
				if(outputString.charAt(i-1)=='R') {
					recovNum++;
				}
			}
			for (int i=1; outputString.length()>=i; i++) {
				if(outputString.charAt(i-1)=='S') {
					susNum++;
				}
			}
			int num1 = infecNum;
			int num2 = numIndiv;
			while (num1 != num2) {
				if (num1 > num2) {
					num1 = num1 - num2;
					gcd = num1;
				} else {
					num2 = num2 - num1;
					gcd = num2;
				}
			}
			pWriter.println("Number of infected individuals: " + infecNum);
			pWriter.println("Number of recovered individuals: " + recovNum);
			pWriter.println("Number of susceptible individuals: " + susNum);
			pWriter.println("Ratio of infected individuals to total number of individuals: " + (infecNum/gcd) + ":" + (numIndiv/gcd));
			pWriter.close();
		} catch (IOException ioe) {
			System.out.println("Error has occurred.");
		}
		}
//		****************************************************************************************************
	}

	public static int testTopNeighbor(int stringIndex, int numIdv, String createdString) {
		int isInfected = 0;
		if(createdString.charAt(stringIndex-1-((int)Math.sqrt(numIdv)))=='I')
			isInfected = 1;
			return isInfected;
	}
	public static int testLeftNeighbor(int stringIndex, int numIdv, String createdString) {
		int isInfected = 0;
		if(createdString.charAt(stringIndex-2)=='I')
			isInfected = 1;
		return isInfected;
	}
	public static int testRightNeighbor(int stringIndex, int numIdv, String createdString) {
		int isInfected = 0;
		if(createdString.charAt(stringIndex)=='I')
			isInfected = 1;
		return isInfected;
	}
	public static int testBottomNeighbor(int stringIndex, int numIdv, String createdString) {
		int isInfected = 0;
		if(createdString.charAt(stringIndex-1+((int)Math.sqrt(numIdv)))=='I')
			isInfected = 1;
			return isInfected;
	}
	
	
	public static int getNumber0to100() {
	    return (int) ((Math.random() * (100 - 0)) + 0);
	}
}

*****************************************************************************************************************

		int numRecovered = 0;
		int numInfected = 0;
		int numSuseptable = 0;
		
		//ask user to input perfect square 
		System.out.println("Please input a number of individuals. It should be a perfect square value.");
		Scanner scnr = new Scanner(System.in);
		int numIndiv = scnr.nextInt();
		
		//userInput validation for perfect square
		double root = Math.sqrt(numIndiv);
		while ((Math.floor(root)-root)!=0){
			System.out.println("Please input a number of individuals. It should be a perfect square value.");
			numIndiv = scnr.nextInt();
			root = Math.sqrt(numIndiv);
		}
		int numRows = (int) Math.sqrt(numIndiv);//used for later calculations
		
		//input validation for choosing infected person
		System.out.println("Please select a person you would like to be infected. It should be be between 0 and the number of individuals specified.");
		int indexOfInfected = scnr.nextInt();
		while (indexOfInfected <= 0 || indexOfInfected >= numIndiv) {
			System.out.println("Please select a person you would like to be infected. It should be be between 0 and the number of individuals specified.");
			indexOfInfected = scnr.nextInt();
		}
		
		//user input validation for numSteps (number of steps)
		int numSteps;
		do {
			System.out.println("Please input the number of times the simulation will run.");
			numSteps = scnr.nextInt();
		} while(numSteps<=0);
		
		// user input validation for alpha (infection rate) 
		float alpha;
		do{
			System.out.println("Enter the rate of infection alpha (alpha <= .25): ");
			alpha = scnr.nextFloat();
		} while (alpha>.25 || alpha < 0);
		
		// user input validation for beta (recovery rate)
		float beta;
		do {
			System.out.println("Please input the recovery rate. It should be between 0 and 1.");
			beta = scnr.nextFloat();
		} while(beta<0 || beta>1);
		
		//create string based on user input
		int counter = 0;
		String createdString = "";
		while (numIndiv>counter) {
			if (counter+1==indexOfInfected) {
				createdString = createdString + "i";
				++counter;
				continue;
			}
			createdString = createdString + "S";
			++counter;
		}
		System.out.println(createdString);
		
		StringBuilder prevIteration = new StringBuilder(createdString);
		StringBuilder currentIteration = new StringBuilder(createdString);//need this syntax to change individual characters of string
		int currentRowNum = 1;//declare row number
		
		for (int stringIndex = 1; stringIndex<=numIndiv; ++stringIndex) {//iterate through entire string char by char
			//check is user is already recovered
			if (prevIteration.charAt(stringIndex-1)=='R') {
				continue;
			}
			
			//check if top left corner piece
			if (stringIndex==1) {
				if(testRightNeighbor(stringIndex, numIndiv, createdString)+testBottomNeighbor(stringIndex, numIndiv, createdString)>0) {
					if(getNumber0to100()<=(alpha*(testRightNeighbor(stringIndex, numIndiv, createdString)+testBottomNeighbor(stringIndex, numIndiv, createdString))))
						currentIteration.setCharAt(stringIndex-1,'I'); //change corner person's status 
					}
			}
			//check if top right corner piece
			else if (stringIndex==numRows) {
				if(testLeftNeighbor(stringIndex, numIndiv, createdString)+testBottomNeighbor(stringIndex, numIndiv, createdString)>0) {
					if(getNumber0to100()<=(100*alpha*(testLeftNeighbor(stringIndex, numIndiv, createdString)+testBottomNeighbor(stringIndex, numIndiv, createdString))))
						outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
					}
			}
			//check if bottom left corner piece
			else if (stringIndex==numIndiv-numRows+1) {
				if(testRightNeighbor(stringIndex, numIndiv, createdString)+testTopNeighbor(stringIndex, numIndiv, createdString)>0) {
					if(getNumber0to100()<=(100*alpha*(testRightNeighbor(stringIndex, numIndiv, createdString)+testTopNeighbor(stringIndex, numIndiv, createdString))))
						outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
			}
			//check if bottom right corner piece
			else if (stringIndex==numIndiv) {
				if(testLeftNeighbor(stringIndex, numIndiv, createdString)+testTopNeighbor(stringIndex, numIndiv, createdString)>0) {
					if(getNumber0to100()<=(100*alpha*(testLeftNeighbor(stringIndex, numIndiv, createdString)+testTopNeighbor(stringIndex, numIndiv, createdString))))
						outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
				}
			}
			//check if right edge piece
			else if (stringIndex>numRows && stringIndex!=numIndiv && stringIndex%numRows == 0 && stringIndex!=1 && stringIndex!=numRows && stringIndex!=numIndiv-numRows+1) {
				/if(testLeftNeighbor(stringIndex, numIndiv, createdString)+testBottomNeighbor(stringIndex, numIndiv, createdString)+testTopNeighbor(stringIndex, numIndiv, createdString)>0) {
					if(getNumber0to100()<=(100*alpha*(testLeftNeighbor(stringIndex, numIndiv, createdString)+testBottomNeighbor(stringIndex, numIndiv, createdString)+testTopNeighbor(stringIndex, numIndiv, createdString))))
						outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
				}
			}
			//check if left edge piece
			else if (currentRowNum>1 && stringIndex==(currentRowNum-1)*(numRows)+1 && stringIndex!=numIndiv-numRows+1 && stringIndex!=1 && stringIndex!=numRows && stringIndex!=numIndiv-numRows+1) {
				if(testRightNeighbor(stringIndex, numIndiv, createdString)+testBottomNeighbor(stringIndex, numIndiv, createdString)+testTopNeighbor(stringIndex, numIndiv, createdString)>0) {
					if(getNumber0to100()<=(100*alpha*(testRightNeighbor(stringIndex, numIndiv, createdString)+testBottomNeighbor(stringIndex, numIndiv, createdString)+testTopNeighbor(stringIndex, numIndiv, createdString))))
						outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
				} 
			}
			//check for top edge pieces
			else if (stringIndex < numRows && stringIndex>0 && stringIndex!=1 && stringIndex!=numRows && stringIndex!=numIndiv-numRows+1) {
				if(testBottomNeighbor(stringIndex, numIndiv, createdString)+testLeftNeighbor(stringIndex, numIndiv, createdString)+testRightNeighbor(stringIndex, numIndiv, createdString)>0) {
					if(getNumber0to100()<=(100*alpha*(testBottomNeighbor(stringIndex, numIndiv, createdString)+testLeftNeighbor(stringIndex, numIndiv, createdString)+testRightNeighbor(stringIndex, numIndiv, createdString))))
						outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
				}
			}
			//check if bottom edge piece
			else if (currentRowNum == numRows && stringIndex>((currentRowNum-1)*(numRows)+1) && stringIndex<numIndiv && stringIndex!=1 && stringIndex!=numRows && stringIndex!=numIndiv-numRows+1) {
				if(testTopNeighbor(stringIndex, numIndiv, createdString)+testLeftNeighbor(stringIndex, numIndiv, createdString)+testRightNeighbor(stringIndex, numIndiv, createdString)>0) {
					if(getNumber0to100()<=(100*alpha*(testTopNeighbor(stringIndex, numIndiv, createdString)+testLeftNeighbor(stringIndex, numIndiv, createdString)+testRightNeighbor(stringIndex, numIndiv, createdString))))
						outputString.setCharAt(stringIndex-1,'I'); //change corner person's status 
				}
			}
			//all inside people
			else {
				if(testLeftNeighbor(stringIndex, numIndiv, createdString)+testLeftNeighbor(stringIndex, numIndiv, createdString)+testBottomNeighbor(stringIndex, numIndiv, createdString)+testTopNeighbor(stringIndex, numIndiv, createdString)>0) {
					if(getNumber0to100()<=(100*alpha*(testLeftNeighbor(stringIndex, numIndiv, createdString)+testRightNeighbor(stringIndex, numIndiv, createdString)+testBottomNeighbor(stringIndex, numIndiv, createdString)+testTopNeighbor(stringIndex, numIndiv, createdString))))
						outputString.setCharAt(stringIndex-1,'I'); //change inside people status
					}
			}
			//increment currentRowNum 
			if (stringIndex%numRows==0 && stringIndex > 0 && stringIndex<numIndiv) {
		        ++currentRowNum;
				/*System.out.print(stringIndex + " ");
				System.out.println(currentRowNum);*/
			}
			
			if(prevIteration.charAt(stringIndex) == 'I') {
				if(getNumber0to100() <= (beta * 100)) {
					currentIteration.setCharAt(stringIndex-1, 'R');
				}
			}
			prevIteration = currentIteration;
		}
		
		//format outputString and print
		for (int i= 1;currentIteration.length()>=i;++i) {
			System.out.print(currentIteration.charAt(i-1));
			if (i%numRows == 0 && i>0) {
				System.out.println("");
			}
		}
		
		try {
			FileWriter fWriter = new FileWriter("virussim.txt", true);
			PrintWriter pWriter = new PrintWriter(fWriter);
			int infecNum = 0;
			int recovNum = 0;
			int susNum = 0;
			int gcd = 0;
			for (int i= 1;outputString.length()>=i;++i) {
				System.out.print(outputString.charAt(i-1));
				pWriter.print(outputString.charAt(i-1));
				if (i%numRows == 0 && i>0) {
					System.out.println("");
					pWriter.println("");
				}
			}
			for (int i=1; outputString.length()>=i; i++) {
				if(outputString.charAt(i-1)=='I') {
					infecNum++;
				}
			}
			for (int i=1; outputString.length()>=i; i++) {
				if(outputString.charAt(i-1)=='R') {
					recovNum++;
				}
			}
			for (int i=1; outputString.length()>=i; i++) {
				if(outputString.charAt(i-1)=='S') {
					susNum++;
				}
			}
			int num1 = infecNum;
			int num2 = numIndiv;
			while (num1 != num2) {
				if (num1 > num2) {
					num1 = num1 - num2;
					gcd = num1;
				} else {
					num2 = num2 - num1;
					gcd = num2;
				}
			}
			pWriter.println("Number of infected individuals: " + infecNum);
			pWriter.println("Number of recovered individuals: " + recovNum);
			pWriter.println("Number of susceptible individuals: " + susNum);
			pWriter.println("Ratio of infected individuals to total number of individuals: " + (infecNum/gcd) + ":" + (numIndiv/gcd));
			pWriter.close();
		} catch (IOException ioe) {
			System.out.println("Error has occurred.");
		}
		}
		public static int testTopNeighbor(int stringIndex, int numIndiv, String createdString) {
			int isInfected = 0;
			if(createdString.charAt(stringIndex-1-((int)Math.sqrt(numIndiv)))=='I')
				isInfected = 1;
				return isInfected;
		}
		public static int testLeftNeighbor(int stringIndex, int numIndiv, String createdString) {
			int isInfected = 0;
			if(createdString.charAt(stringIndex-2)=='I')
				isInfected = 1;
			return isInfected;
		}
		public static int testRightNeighbor(int stringIndex, int numIndiv, String prevIteration) {
			int isInfected = 0;
			if(createdString.charAt(stringIndex)=='I')
				isInfected = 1;
			return isInfected;
		}
		public static int testBottomNeighbor(int stringIndex, int numIndiv, String createdString) {
			int isInfected = 0;
			if(createdString.charAt(stringIndex-1+((int)Math.sqrt(numIndiv)))=='I')
				isInfected = 1;
				return isInfected;
		}
		
		
		public static int getNumber0to100() {
		    return (int) ((Math.random() * (100 - 0)) + 0);
		}
